// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. Users (Admins and Manager)
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  fullName  String?
  role      Role     @default(MANAGER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  properties Property[]

  @@map("users")
}

// 2. Apartments
model Property {
  id        String   @id @default(uuid())
  name      String
  address   String?
  city      String?
  
  managerId String
  manager   User     @relation(fields: [managerId], references: [id])

  blocks    Block[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("properties")
}

// 3. BLOKLAR
model Block {
  id         String   @id @default(uuid())
  name       String   // Example: "A Bloke"
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  units      Unit[]

  @@map("blocks")
}

// 4. DAİRELER (Bağımsız Bölümler)
model Unit {
  id         String   @id @default(uuid())
  doorNumber String  
  floor      Int
  type       String?  // Example: "3+1"
  
  blockId    String
  block      Block    @relation(fields: [blockId], references: [id], onDelete: Cascade)

  residents  Resident[]
  
  @@map("units")
}

model Resident {
  id        String       @id @default(uuid())
  fullName  String
  phone     String?
  email     String?
  type      ResidentType 
  isActive  Boolean      @default(true) 
  
  unitId    String
  unit      Unit         @relation(fields: [unitId], references: [id], onDelete: Cascade)

  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@map("residents")
}

// ENUMS
enum Role {
  ADMIN   
  MANAGER 
}

enum ResidentType {
  OWNER  
  TENANT  
}